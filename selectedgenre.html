<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>selectedgenre</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header id="header"></header>
    <main>
        <h1></h1>
        <div id="radio"></div>
        <ul id="phrase-list"></ul>
        <div id="popup">
            <div class="modal-content">
                <p id="en"></p>
                <p id="ja"></p>
            </div>
        </div>
    </main>
    <footer id="footer"></footer>
    <script src="js/BtoF_header.js"></script>
    <script src="js/footer.js"></script>
    <script src="js/script.js"></script>
    <script>
        const radio = document.getElementById("radio");
        const savedGenre = JSON.parse(localStorage.getItem("savedGenre"));
        savedGenre.categories.forEach((category, index) => {
            // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ä½œæˆ
            const input = document.createElement("input");
            input.type = "radio";
            input.name = "category";
            input.id = `category-${index}`;
            input.value = category;
            if (index === 0) {
                input.checked = true;  // æœ€åˆã®è¦ç´ ã«ãƒã‚§ãƒƒã‚¯
            }

            // labelè¦ç´ ä½œæˆ
            const label = document.createElement("label");
            label.htmlFor = input.id;
            label.textContent = category;

            // containerã«è¿½åŠ 
            radio.appendChild(input);
            radio.appendChild(label);
        });

        const ul = document.getElementById("phrase-list");
        fetch(`./genre_json/${savedGenre.json}.json`)
            .then(res => res.json())
            .then(data => {
                function renderList() {
                    // é¸æŠã•ã‚Œã¦ã„ã‚‹ category ã‚’å–å¾—
                    const selectedCategory = document.querySelector('input[name="category"]:checked').value;
                    const selectedType = document.querySelector('input[name="type"]:checked').value;
                    ul.innerHTML = ''; // ä¸€æ—¦ã‚¯ãƒªã‚¢
                    data.forEach(phrase => {
                        if (phrase.category === selectedCategory && phrase[selectedType]) {
                            const li = document.createElement('li');
                            li.classList.add('phrase');
                            li.innerHTML = `
                                ${phrase[selectedType]}
                                <span class="play-sound" style="float:right; cursor:pointer;">ğŸ”Š</span>
                            `;
                            ul.appendChild(li);

                            // ã‚¯ãƒªãƒƒã‚¯ â†’ ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
                            li.addEventListener("click", function (event) {
                                if (event.target.classList.contains('play-sound'))
                                    return; // ğŸ”Šã¯é™¤å¤–
                                document.getElementById("en").textContent = phrase.do || phrase.c;
                                document.getElementById("ja").textContent = phrase.ja;
                                document.getElementById("popup").style.display = "flex";
                            });

                            // ğŸ”Š éŸ³å£°ãƒãƒ¼ã‚¯ã‚¯ãƒªãƒƒã‚¯ â†’ èª­ã¿ä¸Šã’
                            li.querySelector('.play-sound').addEventListener('click', function () {
                                const textToSpeak = phrase[selectedType].replace(/(\(.*?\)|\[.*?\])/g, '').trim();
                                const utterance = new SpeechSynthesisUtterance(textToSpeak);
                                utterance.lang = localStorage.getItem("selectedCountry") || "en-US";
                                speechSynthesis.speak(utterance);
                            });
                        }
                    });
                }

                renderList(); // åˆæœŸè¡¨ç¤º

                // ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³åˆ‡ã‚Šæ›¿ãˆæ™‚ã«å†ãƒ¬ãƒ³ãƒ€ãƒ¼
                document.querySelectorAll('input[name="type"]').forEach(radio => {
                    radio.addEventListener('change', renderList);
                });
                document.querySelectorAll('input[name="category"]').forEach(radio => {
                    radio.addEventListener('change', renderList);
                });
            })
            .catch(err => console.error(`${savedGenre.json}.json ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ:`, err));

        // èƒŒæ™¯ã‚¯ãƒªãƒƒã‚¯ã§ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
        document.getElementById("popup").addEventListener("click", function (event) {
            if (event.target === this) {
                this.style.display = "none";
            }
        });
    </script>
</body>
</html>