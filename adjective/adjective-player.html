<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Adjective Player</title>
    <link rel="stylesheet" href="../style.css">
</head>
<body>
    <header id="header"></header>
    <main class="frame-app">
        <div id="card">
            <div id="english"></div>
            <div id="japanese"></div>
        </div>

        <div class="controls">
            <label>
                表示間隔：
                <select id="intervalSelect">
                    <option value="2000">short</option>
                    <option value="3000" selected>medium</option>
                    <option value="4000">long</option>
                </select>
            </label>
            <label>
                日本語表示まで：
                <select id="delaySelect">
                    <option value="2000" selected>2s</option>
                    <option value="3000">3s</option>
                    <option value="4000">4s</option>
                </select>
            </label>
        </div>
        <label class="video_play_pause">
            <input type="checkbox" id="PlayPause" aria-label="再生 / 一時停止">
            <span></span>
        </label>
    </main>
    <footer id="footer"></footer>
    <script src="../js/header.js"></script>
    <script src="../js/footer.js"></script>
    <script src="../js/script.js"></script>
    <script>
        const englishDiv = document.getElementById("english");
        const japaneseDiv = document.getElementById("japanese");
        const playPause = document.getElementById("PlayPause");
        const intervalSelect = document.getElementById("intervalSelect");

        let data = [];
        let timer = null;
        let index = 0;
        let isPlaying = false;

        fetch(`adjective.json`)
            .then(response => response.json())
            .then(json => {
                data = json;
            })
            .catch(error => {
                console.error("JSONの読み込みに失敗しました", error);
            });

        playPause.addEventListener("change", () => {
            if (data.length === 0) {
                playPause.checked = false;
                return;
            }
            if (playPause.checked) {
                startPlayback();
            } else {
                pausePlayback();
            }
        });

        function startPlayback() {
            if (isPlaying) return;
            isPlaying = true;
            const interval = Number(intervalSelect.value);
            showCard(index);  // 初回 or 再開時に表示
            timer = setInterval(() => {
                index++;
                if (index >= data.length) {
                    stopPlayback();
                    playPause.checked = false; // 最後まで行ったらOFF
                    return;
                }
                showCard(index);
            }, interval);
        }

        function pausePlayback() {
            if (!isPlaying) return;
            isPlaying = false;
            clearInterval(timer);
            timer = null;
            speechSynthesis.cancel();  // 音声も止める
        }

        function stopPlayback() {
            pausePlayback();
            index = 0;
        }

        function showCard(i) {
            const phrase = data[i];
            englishDiv.textContent = phrase.en;         // 英語を表示
            japaneseDiv.textContent = "";               // 日本語を隠す
            speakEnglish(phrase.en);                    // 音声再生
            const delay = Number(delaySelect.value);    // 日本語を表示
            jaTimer = setTimeout(() => {
                japaneseDiv.textContent = phrase.ja;
            }, delay);
        }
    </script>
</body>
</html>